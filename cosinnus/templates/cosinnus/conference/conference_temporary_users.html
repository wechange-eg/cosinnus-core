{% extends "cosinnus/base.html" %}
{% load i18n cosinnus_tags static thumbnail %}

{% block page_title %}{{ group.name }} {{ block.super }}{% endblock page_title %}

{% block leftnav %}
    {% include "cosinnus/group/leftnav_group.html"  with current_page="temporaryusers" %}
{% endblock leftnav %}

{% block breadcrumb %}
        {{ block.super }}
        <li class="active">{% trans "Temporary Users" %}</li>
{% endblock %}

{% block content %}

{% group_url 'cosinnus:conference:workshop-participants-download' group=group as workshop_participants_download_page %}

<div class="content-box">
	<div class="tab-pane active">
		<h2>{% trans "Temporary Users" %} ({% if group.conference_is_running %} {% trans "Conference is running" %} {% else %} {% trans "Conference is not running" %} {% endif %})</h2>
		<div class="large-space">{% trans 'Here you can create temporary user accounts that are valid only for this conference and only when you activate them.' %}</div>
	</div>

	{% group_url 'cosinnus:conference:workshop-participants-upload-skeleton' group=group as workshop_participants_upload_skeleton %}
	<p>{% blocktrans %}Please upload a spreadsheet with the following columns: unique user identifier, first name and last name. For Help you can download a template <a href="{{ workshop_participants_upload_skeleton }}">here</a>.{% endblocktrans %}</p>

	<p>{% trans "Then add a row for each account that you want to add. You have to add a unique user identifier but first and last name can be blank." %}</p>

	<form action="{% group_url 'cosinnus:conference:workshop-participants-upload' group=group %}" method="post" enctype="multipart/form-data">
		{% csrf_token %}
		{% include 'cosinnus/fields/default_field.html' with field=upload_form.participants %}
		<button type="submit" class="btn btn-emphasized large-space">
			<ul class="media-list">
				<li class="media">
					<a class="pull-left" href="#">
						<i class="fa fa-upload"></i>
					</a>
					<div class="media-body">
						{% trans "Upload File" %}
					</div>
				</li>
			</ul>
		</button>
	</form>


	{% if members %}
	<table class="table table-striped white-content">
		<thead>
			<tr>
				<th>{% trans 'Workshop user name and email' %}</th>
				<th>{% trans 'active' %}</div></th>
				<th>{% trans 'password' %}</th>
				<th>{% trans 'last login' %}</th>
			</tr>
		</thead>

		{% for member,form in members %}
		<tr>
			<th>
				<div class="pull-left">
					{% if member.cosinnus_profile.workshop_user_name %}
						{{ member.cosinnus_profile.readable_workshop_user_name }}: {{ member.email }}
					{% else %}
						{{ member|full_name }} : {{ member.email }}
					{% endif %}
				</div>
				<div class="pull-left">
					{% captureas modal_remove_id %}userModal_remove_{{member.pk}}{% endcaptureas %}
					<button type="button" class="btn btn-default btn-small btn-autosize large-space" data-toggle="modal" data-target="#{{modal_remove_id}}">
						<ul class="media-list">
							<li class="media">
								<a class="pull-left" href="#">
									<i class="fas fa-user-slash"></i>
								</a>
								<div class="media-body">
									{% trans "remove user" %}
								</div>
							</li>
						</ul>
					</button>
				</div>
			</th>
			<th>
				<div class="pull-left">
					{% if member.is_active %}
						{% trans 'yes'%}
					{% else %}
						{% trans 'no'%}
					{% endif %}
				</div>
				<div class="pull-left">
					{% if member.is_active %}
						{% captureas modal_deactivate_id %}userModal_deactivate_{{member.pk}}{% endcaptureas %}
						<button type="button" class="btn btn-default btn-small btn-autosize large-space" data-toggle="modal" data-target="#{{modal_deactivate_id}}">
							<ul class="media-list">
								<li class="media">
									<a class="pull-left" href="#">
										<i class="fas fa-check-circle"></i>
									</a>
									<div class="media-body">
										{% trans "deactivate" %}
									</div>
								</li>
							</ul>
						</button>
				{% else %}
					{% captureas modal_activate_id %}userModal_activate_{{member.pk}}{% endcaptureas %}
					<button type="button" class="btn btn-default btn-small btn-autosize large-space" data-toggle="modal" data-target="#{{modal_activate_id}}">
						<ul class="media-list">
							<li class="media">
								<a class="pull-left" href="#">
									<i class="fas fa-minus-circle"></i>
								</a>
								<div class="media-body">
									{% trans "activate" %}
								</div>
							</li>
						</ul>
					</button>
				{% endif %}
				</div>
			</th>
			<th>
				<div class="pull-left">
					{% if member.password %}
						{% trans "Password set" %}
					{% else %}
						{% trans "no Password" %}
					{% endif %}
				</div>
				<div class="pull-left">
					{% captureas modal_change_password_id %}userModal_change_password_{{member.pk}}{% endcaptureas %}
					<button type="button" class="btn btn-default btn-small btn-autosize large-space" data-toggle="modal" data-target="#{{modal_change_password_id}}">
						<ul class="media-list">
							<li class="media">
								<a class="pull-left" href="#">
									{% if member.password %}
										<i class="fa fa-key" aria-hidden="true"></i>
									{% else %}
										<i class="fa fa-question" aria-hidden="true"></i>
									{% endif %}
								</a>
								<div class="media-body">
									{% if member.password %}
										{% trans "Change password" %}
									{% else %}
										{% trans "Set password" %}
									{% endif %}
								</div>
							</li>
						</ul>
					</button>
				</div>
			</th>
			<th>
				<div class="pull-left">
					{% if member.last_login %} {{ member.last_login | date }} {% else %} - {% endif %}
				</div>
			</th>
			{% if member.is_active %}
		        {% captureas label %}{% trans "Do you really want to deactivate the member's user account ?" %}{% endcaptureas %}
	            {% captureas title %}{% trans "Deactivate Member" %}{% endcaptureas %}
	            {% captureas action %}{% group_url 'cosinnus:conference:temporary-users' group=object %}{% endcaptureas %}
	            {% include "cosinnus/modal_box.html" with id=modal_deactivate_id label=label title=title form_action=action submit_name="deactivate_member" submit_value=member.id title_icon='fas fa-minus-circle' %}

	        {% else %}
	            {% captureas label %}{% trans "Do you really want to activate the member's user account ?" %}{% endcaptureas %}
	            {% captureas title %}{% trans "Activate Member" %}{% endcaptureas %}
	            {% captureas action %}{% group_url 'cosinnus:conference:temporary-users' group=object %}{% endcaptureas %}
	            {% include "cosinnus/modal_box.html" with id=modal_activate_id label=label title=title form_action=action submit_name="activate_member" submit_value=member.id title_icon='fas fa-check-circle' %}
	        {% endif %}

	        {% captureas label %}{% trans "Do you really want to remove the user?" %}{% endcaptureas %}
	        {% captureas title %}{% trans "Remove User" %}{% endcaptureas %}
	        {% captureas action %}{% group_url 'cosinnus:conference:temporary-users' group=object %}{% endcaptureas %}
	        {% include "cosinnus/modal_box.html" with id=modal_remove_id label=label title=title form_action=action submit_name="remove_member" submit_value=member.id title_icon_full_class='fas fa-user-slash' %}

			{% captureas label_password_change %}{% trans "" %}{% endcaptureas %}
	        {% captureas title_password_change %}{% trans "Change password for User" %}{% endcaptureas %}
	        {% captureas action_password_change %}{% group_url 'cosinnus:conference:temporary-users' group=object %}{% endcaptureas %}
			{% captureas form_extra_visible_fields %}
			{% include 'cosinnus/fields/default_field.html' with field=form.email label=form.email.label %}
			{% include 'cosinnus/fields/default_field.html' with field=form.password label=form.password.label %}
			{% endcaptureas %}
	        {% include "cosinnus/modal_box.html" with id=modal_change_password_id label=label_password_change title=title_password_change form_action=action_password_change submit_name="change_password" form_extra_visible_fields=form_extra_visible_fields submit_value=member.id title_icon_full_class='fas fa-user-slash' %}
		</tr>
		{% endfor %}
	</table>
	{% endif %}

</div>
<div>

<div class="fadedown pull-right regular-space">
	<form action="" method="post">
	{% csrf_token %}
		<button type="submit" class="btn btn-emphasized btn-autosize" name="{% if group.conference_is_running %}finishConferenence{% else %}startConferenence{% endif%}">
			<ul class="media-list">
				<li class="media">
					<a class="pull-left" href="#">
						{% if group.conference_is_running %}
						<i class="far fa-stop-circle"></i>
						{% else %}
						<i class="far fa-play-circle"></i>
						{% endif %}
					</a>
					<div class="media-body">
						{% if group.conference_is_running %}
						{% trans "Finish conference and deactivate user accounts" %}
						{% else %}
						{% trans "Start conference and activate user accounts" %}
						{% endif %}
					</div>
				</li>
			</ul>
		</button>

		<button type="submit" class="btn btn-emphasized btn-autosize" name="downloadPasswords">
			<ul class="media-list">
				<li class="media">
					<a class="pull-left" href="#">
						<i class="fa fa-download"></i>
					</a>
					<div class="media-body">
						{% trans "Download passwords and login info" %}
					</div>
				</li>
			</ul>
		</button>
	</form>
</div>
<div class="fadedown pull-right">
	<button class="btn btn-emphasized">
		<ul class="media-list">
			<li class="media">
				<a class="pull-left" href="{{ workshop_participants_download_page }}">
					<i class="fa fa-download"></i>
				</a>
				<div class="media-body">
					<a href="{{ workshop_participants_download_page }}">{% trans "Download Statistics" %}</a>
				</div>
			</li>
		</ul>
	</button>
</div>


{% comment %}
Removed for now
TODO: remove this feature properly when we refactor this!
<div class="panel panel-default large-space">
    <div class="panel-heading">
        <h4 class="panel-title">
            {% trans "Workshops" %}
            <a class="btn" href="{% url 'cosinnus:group-add' %}?group={{ group.slug }}"><i class="fa fa-plus"></i> {% trans "Add workshop" %}</a>
        </h4>
    </div>
    <div class="panel-body">
	{% for group in group.groups.all %}
	{% group_url 'cosinnus:group-dashboard' group=group as group_url %}
		<div class="fadedown regular-space">
			<div class="btn btn-emphasized w100">
				<ul class="media-list">
					<li class="media">
						<a class="pull-left" href="{{ group_url }}">
							{% include "cosinnus/group/group_avatar_image.html" with group=group %}
						</a>
						<div class="media-body">
							<a href="{{ group_url }}">
								{{ group.name }}
							</a>
						</div>
					</li>
				</ul>
			</div>
		</div>
	{% endfor %}
    </div>
</div>
{% endcomment %}


{% endblock content %}