{% extends "cosinnus/base.html" %}
{% load static from staticfiles %}
{% load i18n bootstrap3 cosinnus_tags widget_tweaks %}

{% block page_title %}{% trans "Search" %}{% endblock %}
{% block content_title %}{% trans "Search" %}{% endblock content_title %}

{% block main_page %}
    <div class="row">
        <form method="get" action="" role="form">
        
          {% if request.GET.models %}
              <input type="hidden" name="models" value="{{ request.GET.models }}" />
          {% endif %}
          
          <div class="col-lg-3 col-md-3 app-main mobile-only">
              <button type="button" class="btn w100 btn-emphasized large-space" onclick="$('#search-options').toggleClass('mobile-hidden')">
                <ul class="media-list">
                  <li class="media">
            
                    <!--
                    <a class="pull-left" href="#">
                      4
                    </a>
                    <a class="pull-left" style="background-color:inherit;" href="#">
                    -->
                    <a class="pull-left" href="#">
                      <i class="fa fa-caret-down"></i>
                    </a>
                    <div class="media-body">
                      {% trans "Search options..." %}
                    </div>
                  </li>
                </ul>
              </button>
          </div>
          
          <div id="search-options" class="col-lg-3 col-md-3 mobile-hidden" style="">
          
          
          <p class="navi-explanation">{% trans "Topics" %}:</p>
          <div class="app-main">
	          <div type="button" class="btn btn-default w100 regular-space">
			    <ul class="media-list">
			        <li class="media">
			            <a class="pull-left" href="#">
			                <i class="fa fa-lightbulb-o"></i>
			            </a>
			            <div class="media-body">
			                {% captureas placeholder %}{% trans "Select topics" %}{% endcaptureas %}
			                {% render_field form.topics class+=" w100" placeholder=placeholder %}
			            </div>
			            
			        </li>
			    </ul>
			  </div>
          </div>
          
          
            <p class="navi-explanation">{% trans "Search in Apps" %}:</p>
            
            <div class="app-main">
              <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}">
                <ul class="media-list">
                  <li class="media">
            
                    <!--
                    <a class="pull-left" href="#">
                      4
                    </a>
                    <a class="pull-left" style="background-color:inherit;" href="#">
                    -->
                    <a class="pull-left" href="#">
                      <i class="fa fa-search"></i>
                    </a>
                    <div class="media-body">
                      {% trans "All" %}
                    </div>
                  </li>
                </ul>
              </button>
            </div>
            
            {% if not 'cosinnus_note' in SETTINGS.COSINNUS_DISABLED_COSINNUS_APPS %}        
                <div class="app-main">
                  <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}&models=note">
                    <ul class="media-list">
                      <li class="media">
                        <!--
                        <a class="pull-left" href="#">
                          2
                        </a>
                        <a class="pull-left" style="background-color:inherit;" href="#">
                        -->
                        <a class="pull-left" href="#">
                          <i class="fa fa-file-text-o"></i>
                        </a>
                        <div class="media-body">
                          {% trans "News" %}
                        </div>
                      </li>
                    </ul>
                  </button>
                </div>
            {% endif %}
            
            {% if not 'cosinnus_event' in SETTINGS.COSINNUS_DISABLED_COSINNUS_APPS %}
                <div class="app-calendar">
                  <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}&models=event">
                    <ul class="media-list">
                      <li class="media">
                        <!--
                        <a class="pull-left" href="#">
                          4
                        </a>
                        <a class="pull-left" style="background-color:inherit;" href="#">
                        -->
                        <a class="pull-left" href="#">
                          <i class="fa fa-calendar"></i>
                        </a>
                        <div class="media-body">
                          {% trans "Events" %}
                        </div>
                      </li>
                    </ul>
                  </button>
                </div>
            {% endif %}
            
            {% if not 'cosinnus_todo' in SETTINGS.COSINNUS_DISABLED_COSINNUS_APPS %}
	            <div class="app-todos">
	              <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}&models=todo">
	                <ul class="media-list">
	                  <li class="media">
	                    <!--
	                    <a class="pull-left" href="#">
	                      2
	                    </a>
	                    <a class="pull-left" style="background-color:inherit;" href="#">
	                    -->
	                    <a class="pull-left" href="#">
	                      <i class="fa fa-tasks"></i>
	                    </a>
	                    <div class="media-body">
	                      {% trans "Todos" %}
	                    </div>
	                  </li>
	                </ul>
	              </button>
	            </div>
            {% endif %}
        
            {% if not 'cosinnus_etherpad' in SETTINGS.COSINNUS_DISABLED_COSINNUS_APPS %}
	            <div class="app-etherpad">
	              <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}&models=etherpad&models=ethercalc">
	                <ul class="media-list">
	                  <li class="media">
	                    <!--
	                    <a class="pull-left" href="#">
	                      2
	                    </a>
	                    <a class="pull-left" style="background-color:inherit;" href="#">
	                    -->
	                    <a class="pull-left" href="#">
	                      <i class="fa fa-file-text-o"></i>
	                    </a>
	                    <div class="media-body">
	                      {% trans "Etherpads" %}
	                    </div>
	                  </li>
	                </ul>
	              </button>
	            </div>
            
	            <div class="app-etherpad">
	              <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}&models=ethercalc">
	                <ul class="media-list">
	                  <li class="media">
	                    <!--
	                    <a class="pull-left" href="#">
	                      2
	                    </a>
	                    <a class="pull-left" style="background-color:inherit;" href="#">
	                    -->
	                    <a class="pull-left" href="#">
	                      <i class="fa fa-table"></i>
	                    </a>
	                    <div class="media-body">
	                      {% trans "Ethercalcs" %}
	                    </div>
	                  </li>
	                </ul>
	              </button>
	            </div>
            {% endif %}
            
            {% if not 'cosinnus_file' in SETTINGS.COSINNUS_DISABLED_COSINNUS_APPS %}
                <div class="app-files">
                  <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}&models=file">
                    <ul class="media-list">
                      <li class="media">
                        <!--
                        <a class="pull-left" href="#">
                          0
                        </a>
                        <a class="pull-left" style="background-color:inherit;" href="#">
                        -->
                        <a class="pull-left" href="#">
                          <i class="fa fa-file"></i>
                        </a>
                        <div class="media-body">
                          {% trans "Files" %}
                        </div>
                      </li>
                    </ul>
                  </button>
                </div>
            {% endif %}
            
            {% if not 'cosinnus_poll' in SETTINGS.COSINNUS_DISABLED_COSINNUS_APPS %}
                <div class="app-poll">
                  <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}&models=poll">
                    <ul class="media-list">
                      <li class="media">
                        <!--
                        <a class="pull-left" href="#">
                          2
                        </a>
                        <a class="pull-left" style="background-color:inherit;" href="#">
                        -->
                        <a class="pull-left" href="#">
                          <i class="fa fa-bar-chart"></i>
                        </a>
                        <div class="media-body">
                          {% trans "Polls" %}
                        </div>
                      </li>
                    </ul>
                  </button>
                </div>
            {% endif %}
            
            {% if not 'cosinnus_marketplace' in SETTINGS.COSINNUS_DISABLED_COSINNUS_APPS %}
                <div class="app-marketplace">
                  <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}&models=offer">
                    <ul class="media-list">
                      <li class="media">
                        <!--
                        <a class="pull-left" href="#">
                          2
                        </a>
                        <a class="pull-left" style="background-color:inherit;" href="#">
                        -->
                        <a class="pull-left" href="#">
                          <i class="fa fa-exchange"></i>
                        </a>
                        <div class="media-body">
                          {% trans "Offers" %}
                        </div>
                      </li>
                    </ul>
                  </button>
                </div>
            {% endif %}
            
            {% comment %}  {% if "groups" in request.GET %} {% endcomment %}
            <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}&models=project">
              <ul class="media-list">
                <li class="media">
                  <!--
                  <a class="pull-left" style="background-color:inherit;" href="#">
                  -->
                  <a class="pull-left" href="#">
                    <i class="fa fa-group"></i>
                  </a>
                  <div class="media-body">
                    {% trans "Projects" %}
                  </div>
                </li>
              </ul>
            </button>
            
            {% comment %}  {% if "groups" in request.GET %} {% endcomment %}
            <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "models" %}&models=group">
              <ul class="media-list">
                <li class="media">
                  <!--
                  <a class="pull-left" style="background-color:inherit;" href="#">
                  -->
                  <a class="pull-left" href="#">
                    <i class="fa fa-sitemap"></i>
                  </a>
                  <div class="media-body">
                    {% trans "Groups" %}
                  </div>
                </li>
              </ul>
            </button>

            <button type="button" class="btn w100 btn-emphasized large-space" href="?{% strip_params request "models" %}&models=organization">
              <ul class="media-list">
                <li class="media">
                  <!--
                  <a class="pull-left" style="background-color:inherit;" href="#">
                  -->
                  <a class="pull-left" href="#">
                    <i class="fa fa-building"></i>
                  </a>
                  <div class="media-body">
                    {% trans "Organizations" %}
                  </div>
                </li>
              </ul>
            </button>

            {% if user.is_authenticated %}
            
                {% if SETTINGS.COSINNUS_CLOUD_ENABLED %}
                    <p class="navi-explanation">
                        {% trans "Search in Cloud files (seperate)" %}:
                        <a href="#" data-toggle="modal" data-target="#cloud-search-help-modal">
			                <i class="fa fa-question-circle-o"></i>
			            </a>
                    </p>
                    {% captureas label %}
	                   <div class="v-offset-s textfield">
					       <p>
                               {% trans "Search results from the Cloud app can currently only be displayed in the Cloud app itself." %}
                           </p>
                           <p>
                               {% trans "To search for Cloud files, please visit the Cloud app and use the integrated search function there." %}
                           </p>
					   </div>
		            {% endcaptureas %}
		            {% captureas title %}{% trans "Searching in Cloud files" %}{% endcaptureas %}
		            {% include "cosinnus/modal_box.html" with id="cloud-search-help-modal" label=label title=title title_icon="fa-cloud" %}
		            
	                <div class="app-cloud">
		                <button type="button" class="btn w100 btn-emphasized large-space" href="{{ SETTINGS.COSINNUS_CLOUD_NEXTCLOUD_URL }}">
		                  <ul class="media-list">
		                    <li class="media">
		                      <!--
		                      <a class="pull-left" style="background-color:inherit;" href="#">
		                      -->
		                      <a class="pull-left" href="#">
		                        <i class="fa fa-cloud"></i>
		                      </a>
		                      <div class="media-body">
		                        {% trans "Search in Cloud files" %}
		                        <i class="fa fa-external-link"></i>
		                      </div>
		                    </li>
		                  </ul>
		                </button>
	                </div>
                {% endif %}
            
	            <p class="navi-explanation">{% trans "Search in teams" %}:</p>
	            
	            {% comment %}  {% if "groups" in request.GET %} {% endcomment %}
	            <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "groups" %}">
	              <ul class="media-list">
	                <li class="media">
	                  <!--
	                  <a class="pull-left" style="background-color:inherit;" href="#">
	                  -->
	                  <a class="pull-left" href="#">
	                    <i class="fa fa-sitemap"></i>
	                  </a>
	                  <div class="media-body">
	                    {% trans "All Projects and Groups" %}
	                  </div>
	                </li>
	              </ul>
	            </button>
	            
	            
	            <button type="button" class="btn w100 btn-emphasized fine-space" href="?{% strip_params request "groups" %}&groups=mine">
	              <ul class="media-list">
	                <li class="media">
	                  <a class="pull-left" href="#">
	                      <i class="fa fa-sitemap"></i>
	                  </a>
	                  <div class="media-body">
	                    {% trans "My Projects and Groups" %}
	                  </div>
	                </li>
	              </ul>
	            </button>
	        
	            <button type="button" class="btn w100 btn-emphasized large-space" href="?{% strip_params request "groups" %}&groups=others">
	              <ul class="media-list">
	                <li class="media">
	                  <a class="pull-left" href="#">
	                      <i class="fa fa-sitemap"></i>
	                  </a>
	                  <div class="media-body">
	                    {% trans "Other Projects and Groups" %}
	                  </div>
	                </li>
	              </ul>
	            </button>
        	{% endif %}
            
            <p class="navi-explanation">{% trans "Search for Users" %}:</p>
        
            {% comment %}  {% if "groups" in request.GET %} {% endcomment %}
            <button type="button" class="btn w100 btn-emphasized large-space" href="?&models=user{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">
              <ul class="media-list">
                <li class="media">
                  <!--
                  <a class="pull-left" style="background-color:inherit;" href="#">
                  -->
                  <a class="pull-left" href="#">
                    <i class="fa fa-user"></i>
                  </a>
                  <div class="media-body">
                    {% trans "Users" %}
                  </div>
                </li>
              </ul>
            </button>

            {% if SETTINGS.COSINNUS_EXCHANGE_ENABLED %}
                <p class="navi-explanation">{% trans "External contents" %}:</p>
                <input type="hidden" name="exchange" value="{% if request.GET.exchange %}true{% endif %}" />
                <button type="button" class="btn w100 btn-emphasized large-space" href="?{% strip_params request "exchange" %}{% if not request.GET.exchange %}&exchange=true{% endif %}">
                  <ul class="media-list">
                    <li class="media">
                      <a class="pull-left" href="?{% strip_params request "exchange" %}{% if not request.GET.exchange %}&exchange=true{% endif %}">
                        <i class="fa fa-{% if request.GET.exchange %}check-{% endif %}square"></i>
                      </a>
                      <div class="media-body">
                        {% trans "Include contents from other platforms" %}
                      </div>
                    </li>
                  </ul>
                </button>
            {% endif %}

            {% comment %}
            <p class="navi-explanation">Ergebnisse filtern:</p>
            
            <ol class="input-area input-area-left-column">
              <li>
                <div class="calendar-date-time-chooser">
                  Von
                  <input
                    placeholder="Datum"
                    readonly ="readonly"
                    class="calendar-date-time-chooser-date" />
                  <input type="hidden"
                    class="calendar-date-time-chooser-hiddendate"
                    value="{{ form.cleaned_data.valid_start|date:"c" }}"
                    name="valid_start" />
                  <div class="small-calendar"></div>
                </div>
                <div class="calendar-date-time-chooser">
                  Bis
                  <input
                    placeholder="Datum"
                    readonly ="readonly"
                    class="calendar-date-time-chooser-date" />
                  <input type="hidden"
                    class="calendar-date-time-chooser-hiddendate"
                    value="{{ form.cleaned_data.valid_end|date:"c" }}"
                    name="valid_end" />
                  <div class="small-calendar"></div>
                </div>
              </li>
            </ol>
        
            <ol class="input-area input-area-left-column">
              <li>
                <input
                  type="hidden"
                  class="location-selector"
                  data-tags="Berlin,Kreuzberg,Oranienhof,Köln,Paris,London,Frankfurt,New York,Peking"
                  data-placeholder="Ort"
                  name="location"
                  value="{{ form.cleaned_data.location }}" />
              </li>
            </ol>
        
        
            <button type="submit" class="btn btn-default">
              <ul class="media-list">
                <li class="media">
                  <a class="pull-left" href="#">
                    <i class="fa fa-search"></i>
                  </a>
                  <div class="media-body">
                    Filtern
                  </div>
                </li>
              </ul>
            </button>
            {% endcomment %}
          </div>
          <div class="col-lg-9 col-md-9">
            <div class="row">
              <div class="col-xs-12">
                <div class="content-box">
                  
                  <div class="w100 large-space clearfix">
	                  <button type="submit" class="btn btn-emphasized no-margin btn-icon-only">
	                    <ul class="media-list">
	                        <li class="media">
	                            <span class="pull-left">
	                                <i class="fa fa-search"></i>
	                            </span>
	                            <div class="media-body">
	                                {% trans "Search" %}
	                            </div>
	                        </li>
	                    </ul>
	                  </button>
	                  
	                  <div type="button" class="btn btn-default w100" style="display: inline;">
	                    <ul class="media-list">
	                      <li class="media">
	                        <div class="media-body media-body-form-control">
	                          <input class="form-control"
	                            placeholder="Suche"
	                            value="{% if query %}{{ query }}{% elif request.GET.q %}{{ request.GET.q }}{% endif %}"
	                            id="searchChangeInput"
	                            autocomplete="off"
	                            name="q" />
	                        </div>
		                      
	                      </li>
	                    </ul>
	                  </div>
	              </div>
                  
                  {% if query or form.cleaned_data.topics %}
                    
                    <div>
                        {% if request.GET.o and request.GET.o == 'newest' %}
                            <span class="inline-list nowrap">
                                <a href="?{% strip_params request "o" %}" class="app-background small-padding"><i class="fa fa-times"></i></a
                                ><span class="app-background-light dark-color small-padding">
                                    {% trans "Ordering" %}: {% trans "Newest" %}
                                </span>
                            </span>
                        {% endif %}
                        
                        {% comment %} 
                        	Ordering removed until the relevance for results can be cutoff-filtered.
                        	Otherwise we have meaningless search results with 0.001 relevance, sorted by new.
                        {% endcomment %}
                        <div class="dropdown pull-right" style="display: none;">
                            <button class="btn btn-default dropdown-toggle autowidth" type="button" id="filter-odering" data-toggle="dropdown" title="{% trans "Ordering" %}">
                                {% trans "Ordering" %}
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="?{% strip_params request "o" %}">{% trans "Relevance" %}</a></li>
                                <li role="presentation"><a role="menuitem" tabindex="-1" href="?{% strip_params request "o" %}&o=newest">{% trans "Newest" %}</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="clearfix"></div>
                    
                    <p class="large-space">
                      {% if query and form.cleaned_data.topics %}
                        {% blocktrans with start=page.start_index end=page.end_index total=paginator.count %}Showing {{ end }} of {{ total }} results for your query "{{ query }}" with topics:{% endblocktrans %}
                      {% elif query %}
                        {% blocktrans with start=page.start_index end=page.end_index total=paginator.count %}Showing {{ end }} of {{ total }} results for your query "{{ query }}"{% endblocktrans %}
                      {% elif form.cleaned_data.topics %}
	                    {% blocktrans with start=page.start_index end=page.end_index total=paginator.count %}Showing {{ end }} of {{ total }} results with topics:{% endblocktrans %}
	                  {% endif %}
	                  
                      {% if form.cleaned_data.topics %}
                        {% trans "or" as or_seperator %}
                        {% render_cosinnus_topics form.cleaned_data.topics or_seperator %}
                      {% endif %}    
                    </p>
                    
        
                    {% for result in page.object_list %}
                    	<!-- <span class="score">{{ result.score }}</span> -->
                      {{ result.rendered|safe }}
                    {% empty %}
                    	{% captureas empty_message %}{% trans "We could not find any results matching your search query." %}{% endcaptureas %}
			            {% include 'cosinnus/common/empty_button.html' with message=empty_message %}
                    {% endfor %}
        
                    {% if page.has_previous or page.has_next %}
                      	<div>
                      		<button type="button" class="btn btn-{% if page.has_previous %}emphasized{% else %}default{% endif %} pull-left" style="margin: 0;" {% if page.has_previous %}href="?{% strip_params request "page" %}&page={{ page.previous_page_number }}"{% else %}disabled=1{% endif %}>
					            <ul class="media-list">
					                <li class="media">
					                    <a class="pull-left" href="#">
					                        <i class="fa fa-chevron-left"></i>
					                    </a>
					                    <div class="media-body">
					                        {% trans "previous" %}
					                    </div>
					                </li>
                      </ul>
					        </button> 
					        
					        <button type="button" class="btn btn-{% if page.has_next %}emphasized{% else %}default{% endif %}" {% if page.has_next %}href="?{% strip_params request "page" %}&page={{ page.next_page_number }}"{% else %}disabled=1{% endif %}>
					            <ul class="media-list">
					                <li class="media">
					                    <a class="pull-left" href="#">
					                        <i class="fa fa-chevron-right"></i>
					                    </a>
					                    <div class="media-body">
					                        {% trans "next" %}
					                    </div>
					                </li>
					            </ul>
					        </button> 
                      	
                      	</div>
                      
                    {% endif %}
                  {% else %}
                    {% captureas empty_message %}{% trans "Enter one or more search terms or select a topic to search." %}{% endcaptureas %}
                    {% include 'cosinnus/common/empty_button.html' with message=empty_message %}
                  {% endif %}
                </div><!-- content-box -->
              </div><!-- col -->
            </div><!-- row -->
          </div><!-- right column -->
        </form>
    </div><!-- row -->
    
{% endblock main_page %}
