{% extends "cosinnus/base.html" %}
{% load i18n cosinnus_tags cosinnus_map_tags static %}

{% block page_title %}
  {% blocktrans with team_name=object.name %}{{ team_name }} - Members{% endblocktrans %}
{% endblock %}

{% block js_app_dependencies %}
    {% include 'cosinnus/map/static_dependencies.html' %}
{% endblock js_app_dependencies %}

{% block og_meta_attributes %}
    {% include 'cosinnus/group/group_og_meta_attributes.html' with group=group %}
{% endblock og_meta_attributes %}


{% block leftnav %}
    {% include "cosinnus/group/leftnav_group.html"  with current_page="groupdetails" %}
    
    {% if object.type == 0 %}
        {% include 'cosinnus/common/help_button_leftnav_for_popup.html' with help_text_id="helptext_12_projectadministration" %}
    {% else %}
        {% include 'cosinnus/common/help_button_leftnav_for_popup.html' with help_text_id="helptext_13_groupadministration" %}
    {% endif %}
{% endblock leftnav %}

{% block breadcrumb %}
        {{ block.super }}
        <li class="active">{% trans "Members" %}</li>
{% endblock %}


{% block content %}
    
    {% if not hide_members %}
        <!-- a box with semi transparent background -->
        <div class="content-box">
            {% include 'cosinnus/common/internet_explorer_not_supported.html' %}
        
            {% captureas map_settings %}{"filterGroup": {{ group.id }}, "controlsEnabled": false, "activeFilters": {"groups": false, "events": false, "projects": {% if group.type == 1 %}true{% else %}false{% endif %}, "people": true}, "availableFilters": {"groups": true, "events": true, "projects": true, "people": true}}{% endcaptureas %}
            {% include 'cosinnus/common/init_client_module.html' with module='module-embed' id=""|add_uuid embed=True height=400 settings=map_settings %}
            <div class="clearfix"></div>
        </div>
    {% endif %}

    {% block join_token_link %}
        {% if group.type in SETTINGS.COSINNUS_ENABLE_USER_JOIN_TOKENS_FOR_GROUP_TYPE %}
            {% if group.use_invite_token and user in admins %}
                <div class="content-box">
                    <p class="transparent">
                        {% trans "Invite users directly via the following link: " %}
                        {% for invite_token in invite_tokens %}
                            <a href="{{ invite_token.get_absolute_url }}" target="_blank">{{ invite_token.get_absolute_url }}</a>
                        {% endfor %}
                    </p>
                </div>
            {% endif %}
        {% endif %}
    {% endblock join_token_link %}
    
    
    {% if hide_members %}
    
        <!-- a box with semi transparent background -->
        <div class="content-box">
            <div class="white-content transparent textfield">
                <h2>{{ group.name }}</h2>
                <p>{% trans "Note: Detailed member lists for platform-wide content are not displayed." %}</p>
            </div>
        </div>
    
    {% else %}
    
        <!-- a box with semi transparent background -->
        <div class="content-box">
            
            {% comment %}  leave this here, the jump is what we want always  {% endcomment %} 
            <a class="anchor" id="invite"></a>
            
            
            {% if user|has_write_access:object and group.group_is_conference and group.use_conference_applications %}
                <div class="panel panel-default large-space">
                    <div class="panel-heading">
                        <h4 class="panel-title" data-toggle="collapse" data-target="#collapseFive">
                            <i class="fa fa-chevron-down panel-collapsed"></i>
                            <i class="fa fa-chevron-up panel-open"></i>
                            {% trans "Membership requests" %} {% if pendings|length > 0 %}({{ pendings|length }}){% endif %}
                        </h4>
                    </div>
                    <div id="collapseFive" class="panel-collapse in">
                        <div class="panel-body">
                            <div class="textfield transparent">
                                <p>
                                    {% trans "Please manage participation applications via the applications page. You can disable the participation management in the conference settings." %}
                                </p>
                            </div>
        
                            <button type="button" href="{% group_url "cosinnus:conference:participation-management-applications" group=group %}" 
                                     class="btn btn-emphasized btn-autosize no-margin pull-left" title="{% trans "Manage applications" %}">
                                <ul class="media-list">
                                    <li class="media">
                                        <span class="pull-left">
                                            <i class="fas fa-user-friends"></i>
                                        </span>
                                        <div class="media-body">
                                            {% trans "Manage applications" %}
                                        </div>
                                    </li>
                                </ul>
                            </button>
                            <div class="clearfix"></div>
                        </div>
                    </div>
                </div>
            {% endif %}
            
            {% if not object.slug == SETTINGS.NEWW_FORUM_GROUP_SLUG and not object.slug in SETTINGS.NEWW_DEFAULT_USER_GROUPS %}
    
                {% if user|has_write_access:object and group.group_is_conference and group.use_conference_applications %}
                    <div class="panel panel-default large-space">
                        <div class="panel-heading">
                            <h4 class="panel-title collapsed" data-toggle="collapse" data-target="#collapseGroupsInvite">
                                <i class="fa fa-chevron-down panel-collapsed"></i>
                                <i class="fa fa-chevron-up panel-open"></i>
                                {% trans "Invite members of groups/projects to apply..." %}
                                {% if invited_groups|length > 0 %}({{ invited_groups|length }}){% endif %}
                            </h4>
                        </div>
                        <div id="collapseGroupsInvite" class="panel-collapse collapse">
                            <div class="panel-body">
                                <legend>{% trans "Invite members of groups/projects to apply..." %}</legend>
                                <form action="{% group_url 'cosinnus:group-add-multiple' group=object %}" method="post" class="cosinnus-form">
                                    {% csrf_token %}
                                    {{ group_invite_form.non_field_errors }}
        
                                    {{ group_invite_form.groups.errors }}
                                    {% trans "Select one or more groups/projects..." as inv_placeholder %}
                                    {% include 'cosinnus/fields/default_field.html' with field=group_invite_form.groups placeholder=inv_placeholder first=True %}
        
                                    <button type="submit" class="btn btn-emphasized btn-autosize large-space">
                                        <ul class="media-list">
                                            <li class="media">
                                                <span class="pull-left">
                                                    <i class="fa fa-check"></i>
                                                </span>
                                                <div class="media-body">
                                                    {% trans "Invite groups" %}
                                                </div>
                                            </li>
                                        </ul>
                                    </button>
                                </form>
                                <div class="clearfix"></div>
                                
                                {% if invited_groups|length > 0 %}
                                    <legend>{% trans "Invited group/project members" %}</legend>
                        
                                    {% for group in invited_groups %}
                                        <div class="regular-space">
                                            <div class="btn btn-default w100" href="{{ group.get_absolute_url }}">
                                                <ul class="media-list">
                                                    <li class="media">
                                                        <span class="pull-left">
                                                            <i class="fas fa-fw fa-group"></i>
                                                        </span>
                                                        {% comment %}
                                                            Revoke group invite button removed for now, as it would give the impression
                                                            of being an "undo" button, while all invititations that have already been 
                                                            sent don't actually get revoked.
                                                            
                                                            {% captureas modal_group_revoke_id %}groupModal_revoke_{{group.pk}}{% endcaptureas %}
                                                            <button type="button" class="btn btn-emphasized btn-icon-only pull-right"
                                                                    data-toggle="modal" data-target="#{{modal_group_revoke_id}}" title="{% trans "Revoke Invitation" %}">
                                                                    <ul class="media-list">
                                                                        <li class="media">
                                                                            <span class="pull-left">
                                                                                <i class="fa fa-close"></i>
                                                                            </span>
                                                                        </li>
                                                                    </ul>
                                                            </button>
                                                            {% captureas label %}{% blocktrans with name=group.name %}Do you really want to revoke the invitation for member „{{ name }}“?{% endblocktrans %}{% endcaptureas %}
                                                            {% captureas title %}{% trans "Revoke Invitation for Group" %}{% endcaptureas %}
                                                            {% captureas action %}{% group_url 'cosinnus:group-group-invite-delete' group=object %}{% endcaptureas %}
                                                            {% captureas group_id %}{{ group.id }}{% endcaptureas %}
                                                            {% include "cosinnus/modal_box.html" with id=modal_group_revoke_id label=label title=title form_action=action submit_name="remove-group-invitation" submit_value=group_id %}
                                                        {% endcomment %}
                                                        <div class="media-body">
                                                            <a href="{{ group.get_absolute_url }}">
                                                                {{ group.name }}
                                                            </a>
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% endif %}
                                
                            </div>
                        </div>
                    </div>
                {% endif %}
    
    
    
                {% if user|has_write_access:object or user in invited %}
                    <div class="panel panel-default large-space">
                        <div class="panel-heading">
                            <h4 class="panel-title {% if not request.GET.invite %}collapsed{% endif %}" data-toggle="collapse" data-target="#collapseOne">
                                <i class="fa fa-chevron-down panel-collapsed"></i>
                                <i class="fa fa-chevron-up panel-open"></i>
                                {% if group.group_is_conference and group.use_conference_applications %}
                                    {% trans "Invite registered users to apply..." %} 
                                {% else %}
                                    {% trans "Invite registered users..." %} 
                                {% endif %}
                                
                                {% if invited|length > 0 %}({{ invited|length }}){% endif %}
                            </h4>
                        </div>
                        <div id="collapseOne" class="panel-collapse {% if not request.GET.invite %}collapse{% else %}in{% endif %}">
                            <div class="panel-body">
                                
                                {% if user|has_write_access:object %}
                                    <legend>{% trans "Invite a member" %}</legend>
                                    
                                    <form action="{% group_url 'cosinnus:group-user-add-multiple' group=object %}" method="post" class="cosinnus-form">
                                        {% csrf_token %}
                                        {{ member_invite_form.non_field_errors }}
                                        
                                        {{ member_invite_form.users.errors }}
                                        {% trans "Enter a user name or email to find users to invite..." as inv_placeholder %}
                                        {% include 'cosinnus/fields/default_field.html' with field=member_invite_form.users placeholder=inv_placeholder first=True %}
                                    
                                        <button type="submit" class="btn btn-emphasized btn-autosize large-space">
                                            <ul class="media-list">
                                                <li class="media">
                                                    <span class="pull-left">
                                                        <i class="fa fa-check"></i>
                                                    </span>
                                                    <div class="media-body">
                                                        {% trans "Invite users" %}
                                                    </div>
                                                </li>
                                            </ul>
                                        </button>
                                    </form>
                                {% endif %}
                                
                                
                                {% if user|has_write_access:object or user in invited %}
                                    
                                    <legend>{% trans "Invited Members" %}</legend>
                                    
                                    {% for member in invited %}
                                       {% comment %} In public groups, we enable the logged in user to see himself as pending user {% endcomment %}
                                       {% if user|has_write_access:object or user == member %}
                                            <div class="regular-space">
                                                <div class="btn btn-default w100 user-list-button">
                                                    <ul class="media-list">
                                                        <li class="media">
                                                            <a class="pull-left" href="{{ member|profile_url }}">
                                                                {% include "cosinnus/user/user_avatar_image.html" with user=member %}
                                                            </a>
                                                            
                                                            
                                                            {% if user|has_write_access:object %}
                                                                    {% captureas modal_revoke_id %}userModal_revoke_{{member.pk}}{% endcaptureas %}
                                                                    
                                                                    <button type="button" class="btn btn-emphasized btn-icon-only pull-right" 
                                                                             data-toggle="modal" data-target="#{{modal_revoke_id}}" title="{% trans "Revoke Invitation" %}">
                                                                        <ul class="media-list">
                                                                            <li class="media">
                                                                                <span class="pull-left">
                                                                                    <i class="fa fa-close"></i>
                                                                                </span>
                                                                            </li>
                                                                        </ul>
                                                                    </button>
                                                            {% endif %}
                                                            
                                                            {% if user == member %}
                                                                <div>
                                                                    {% captureas modal_decline_invitation_id %}userModal_decline_invitation_{{member.pk}}{% endcaptureas %}
                                                                    <button type="button" class="btn btn-emphasized btn-icon-only pull-right" 
                                                                             data-toggle="modal" data-target="#{{modal_decline_invitation_id}}" title="{% trans "Decline Invitation" %}">
                                                                        <ul class="media-list">
                                                                            <li class="media">
                                                                                <span class="pull-left">
                                                                                    <i class="fa fa-close"></i>
                                                                                </span>
                                                                            </li>
                                                                        </ul>
                                                                    </button>
                                                                    
                                                                    <form action="{% group_url 'cosinnus:group-user-accept' group=object %}" method="post">{% csrf_token %}
                                                                        <button type="submit" class="btn btn-emphasized">
                                                                            <ul class="media-list">
                                                                                <li class="media">
                                                                                    <span class="pull-left">
                                                                                        <i class="fa fa-sign-in"></i>
                                                                                    </span>
                                                                                    <div class="media-body">
                                                                                        {% trans "Accept Invitation" %}
                                                                                    </div>
                                                                                </li>
                                                                            </ul>
                                                                        </button>
                                                                    </form>
                                                                </div>
                                                            {% endif %}
                                                            
                                                            
                                                            <div class="media-body">
                                                                <span class="annotation mobile-hidden">
                                                                    {% trans "Invited to be a member" %}
                                                                    &nbsp;
                                                                    <span class="moment-data-date" data-date="{{ member.membership_status_date|date:'c' }}"></span>
                                                                </span>
                                                                <a class="username-name" href="{% url 'cosinnus:profile-detail' username=member.username %}">
                                                                    {{ member|full_name }}
                                                                </a>
                                                                {% include 'cosinnus/user/member_list_name_snippet.html' with user=member %}
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            
                                            {% if user|has_write_access:object %}    
                                                {% captureas label %}{% blocktrans with name=member|full_name %}Do you really want to revoke the invitation for member „{{ name }}“?{% endblocktrans %}{% endcaptureas %}
                                                {% captureas title %}{% trans "Revoke Invitation for Member" %}{% endcaptureas %}
                                                {% captureas action %}{% group_url 'cosinnus:group-user-delete' group=object username=member.username %}{% endcaptureas %}
                                                {% include "cosinnus/modal_box.html" with id=modal_revoke_id label=label title=title form_action=action %}
                                            {% endif %}
                                            {% if user == member %}    
                                                {% captureas label %}{% blocktrans %}Do you really want to decline the invitation?{% endblocktrans %}{% endcaptureas %}
                                                {% captureas title %}{% trans "Decline Invitation" %}{% endcaptureas %}
                                                {% captureas action %}{% group_url 'cosinnus:group-user-decline' group=object %}{% endcaptureas %}
                                                {% include "cosinnus/modal_box.html" with id=modal_decline_invitation_id label=label title=title form_action=action %}
                                            {% endif %}
                                        
                                        {% endif %}
                                        
                                    {% empty %}
                                        <!-- {% trans "There are no pending invitations." %} -->
                                        {% include 'cosinnus/common/empty_button.html' with message="There are no pending invitations." %}
                                    {% endfor %}
                                    
                                {% endif %}
                                
                                
                                
                            </div> {% comment %} panel-body {% endcomment %}
                        </div> {% comment %} panel-collapse {% endcomment %}
                    </div> {% comment %} panel {% endcomment %}
                {% endif %}
                
                {% if SETTINGS.COSINNUS_USER_SIGNUP_ENABLED %}
                    {% if user in admins or user_is_superuser or recruited %}
            
                        <div class="panel panel-default large-space">
                            <div class="panel-heading">
                                <h4 class="panel-title {% if not request.GET.invite %}collapsed{% endif %}" data-toggle="collapse" data-target="#collapseTwo">
                                    <i class="fa fa-chevron-down panel-collapsed"></i>
                                    <i class="fa fa-chevron-up panel-open"></i>
                                    {% if group.group_is_conference and group.use_conference_applications %}
                                        {% trans "Invite unregistered users to apply..." %}
                                    {% else %}
                                        {% trans "Invite unregistered users..." %} 
                                    {% endif %}
                                    {% if recruited|length > 0 %}({{ recruited|length }}){% endif %}
                                </h4>
                            </div>
                            <div id="collapseTwo" class="panel-collapse {% if not request.GET.invite %}collapse{% else %}in{% endif %}">
                                <div class="panel-body">
                        
                                    {% comment %} -------- Recruit Box and list of recruitees -------- {% endcomment %}
                                    
                                    {% if user in admins or user_is_superuser %}
                                        <div class="clearfix large-space"></div>
                                    
                                        <legend>{% trans "Invite People to Register and Join" %}</legend>
                                        
                                        <button type="submit" class="btn btn-emphasized btn-autosize btn-left" data-toggle="modal" data-target="#modal-recruit-users">
                                            <ul class="media-list">
                                                <li class="media">
                                                    <span class="pull-left">
                                                        <i class="fa fa-user-plus"></i>
                                                    </span>
                                                    <div class="media-body">
                                                        {% trans "Invite people" %}
                                                    </div>
                                                </li>
                                            </ul>
                                        </button>
    
                                        <!-- {% include 'cosinnus/common/empty_button.html' with message="There are no new membership requests." %} -->
                                        
                                        <div class="clearfix large-space"></div>
                                        <div class="alert alert-warning alert-dismissable" id="label-invite-email-added" style="display: none; min-height: 48px;">
                                            <i class="fa fa-arrow-up" style="font-size: 18px;"></i>
                                            {% trans 'The email was added to the invite list. Click "Invite people" to resend the invitations!' %}
                                        </div>
                                        
                                        {% include 'cosinnus/common/modal_box_recruit_users.html' %}
                                        
                                        <div class="clearfix"></div>
                                    {% endif %}
                                    
                                    {% if recruited %}
                                        {% if user in admins or user_is_superuser %}        
                                            <legend>{% trans "All currently invited people" %}</legend>
                                        {% else %}
                                            <legend>{% trans "People currently invited by you" %}</legend>
                                        {% endif %}
                                        
                                            {% for recruitation in recruited %}
                                                {% captureas modal_id %}deleteModal_{{recruitation.id}}{% endcaptureas %}
                                                
                                                <div class="btn btn-default w100 regular-space">
                                                    <ul class="media-list">
                                                        <li class="media">
                                                            {% if user == recruitation.invited_by or user in admins or user_is_superuser %}
                                                                <button type="button" class="btn btn-emphasized btn-icon-only pull-right" 
                                                                         data-toggle="modal" data-target="#{{modal_id}}" title="{% trans "Delete invitation" %}">
                                                                    <ul class="media-list">
                                                                        <li class="media">
                                                                            <span class="pull-left">
                                                                                <i class="fa fa-trash"></i>
                                                                            </span>
                                                                        </li>
                                                                    </ul>
                                                                </button>
                                                                
                                                                <button data-email="{{ recruitation.email }}" type="button" class="btn btn-emphasized btn-icon-only pull-right button-add-email" title="{% trans "Resend invitation" %}">
                                                                    <ul class="media-list">
                                                                        <li class="media">
                                                                            <span class="pull-left">
                                                                                <i class="fa fa-refresh"></i>
                                                                            </span>
                                                                        </li>
                                                                    </ul>
                                                                </button>
                                                                
                                                            {% endif %}
                                                            <div class="media-body">
                                                                <span class="annotation mobile-hidden">
                                                                    {% trans "Invited to be a member" %}
                                                                    &nbsp;
                                                                    <span class="moment-data-date" data-date="{{ recruitation.last_modified|date:'c' }}"></span>
                                                                </span>
                                                                <span>
                                                                    {{ recruitation.email }}
                                                                </span>
                                                                {% if recruitation.invited_by and not recruitation.invited_by == user %}
                                                                    <i>
                                                                       ({% trans "by" context "an action done *by* <username>" %}
                                                                       <a href="{% url 'cosinnus:profile-detail' username=recruitation.invited_by.username %}">{{ recruitation.invited_by|full_name }}</a>)
                                                                    </i>
                                                                {% endif %}
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                                {% if user == recruitation.invited_by or user in admins or user_is_superuser %}
                                                    {% captureas label %}{% blocktrans with title=recruitation.email %}Do you really want to delete the invitation for "{{ title }}"?{% endblocktrans %}{% endcaptureas %}
                                                    {% captureas title %}{% trans "Delete invitation" %}{% endcaptureas %}
                                                    {% captureas action %}{% group_url 'cosinnus:group-user-recruit-delete' group=group id=recruitation.id %}{% endcaptureas %}
                                                    {% include "cosinnus/modal_box.html" with id=modal_id label=label title=title form_action=action %}
                                                {% endif %}
                                            {% endfor %}
                                            
                                            {% comment %} Adds the recruitee's email to the recruit recipient box and shows a message {% endcomment %}
                                            <script type="text/javascript">
                                               $('.button-add-email').click(function(){
                                                   var $this = $(this);
                                                   var disabled = $this.attr('disabled');
                                                   if (typeof disabled !== typeof undefined && disabled !== false) {
                                                       return;
                                                   };
                                                   // add email to recruitee box
                                                   var textarea = $('#recruit-user-emails');
                                                   textarea.val($this.attr('data-email') + '\n' + textarea.val());
                                                   // disable button and show message
                                                   $this
                                                       .attr('disabled', 'disabled')
                                                       .removeClass('btn-emphasized')
                                                       .addClass('btn-default')
                                                       .find('i.fa')
                                                           .removeClass('fa-refresh')
                                                           .addClass('fa-plus');
                                                   $('#label-invite-email-added').fadeIn();
                                               });
                                            </script>
                                        
                                        <div class="clearfix"></div>
                                    {% endif %}
                
                                </div> {% comment %} panel-body {% endcomment %}
                            </div> {% comment %} panel-collapse {% endcomment %}
                        </div> {% comment %} panel {% endcomment %}
                    
                    {% endif %}
                {% endif %}
                
                {% if not group.group_is_conference or not group.use_conference_applications %}
                    {% if user|has_write_access:object or user in pendings %}
                    
                        <div class="panel panel-default large-space">
                            <div class="panel-heading">
                                <h4 class="panel-title {% if not pendings|length > 0 and not request.GET.requests %}collapsed{% endif %}" data-toggle="collapse" data-target="#collapseFour">
                                    <i class="fa fa-chevron-down panel-collapsed"></i>
                                    <i class="fa fa-chevron-up panel-open"></i>
                                    {% trans "Membership requests" %} {% if pendings|length > 0 %}({{ pendings|length }}){% endif %}
                                </h4>
                            </div>
                            <div id="collapseFour" class="panel-collapse {% if not pendings|length > 0 and not request.GET.requests %}collapse{% else %}in{% endif %}">
                                <div class="panel-body">
                                
                                        
                                    <legend id="requests">{% trans "Membership requests" %}</legend>
                                    
                                    {% for member in pendings %}
                                       
                                       {% comment %} In public groups, we enable the logged in user to see himself as pending user {% endcomment %}
                                       {% if not user in pendings or user == member %}
                                            <div class="regular-space">
                                                <div class="btn btn-default w100 user-list-button">
                                                    <ul class="media-list">
                                                        <li class="media">
                                                            <a class="pull-left" href="{{ member|profile_url }}">
                                                                {% include "cosinnus/user/user_avatar_image.html" with user=member %}
                                                            </a>
                                                            
                                                            {% if user|has_write_access:object %}
                                                                {% captureas modal_kick_id %}userModal_kick_{{member.pk}}{% endcaptureas %}
                                                                {% captureas modal_promote_id %}userModal_promote_{{member.pk}}{% endcaptureas %}
                                                                <button type="button" class="btn btn-emphasized btn-icon-only pull-right" 
                                                                         data-toggle="modal" data-target="#{{modal_kick_id}}" title="{% trans "Decline User" %}">
                                                                    <ul class="media-list">
                                                                        <li class="media">
                                                                            <span class="pull-left">
                                                                                <i class="fa fa-close"></i>
                                                                            </span>
                                                                        </li>
                                                                    </ul>
                                                                </button>
                                                                
                                                                <button type="button" class="btn btn-emphasized btn-icon-only pull-right" 
                                                                         data-toggle="modal" data-target="#{{modal_promote_id}}" title="{% trans "Accept User" %}">
                                                                    <ul class="media-list">
                                                                        <li class="media">
                                                                            <span class="pull-left">
                                                                                <i class="fa fa-check"></i>
                                                                            </span>
                                                                        </li>
                                                                    </ul>
                                                                </button>
                                                            {% endif %}
                                                            
                                                            <div class="media-body">
                                                                <span class="annotation mobile-hidden">
                                                                    {% trans "Membership requested" %}
                                                                    &nbsp;
                                                                    <span class="moment-data-date" data-date="{{ member.membership_status_date|date:'c' }}"></span>
                                                                </span>
                                                                <a class="username-name" href="{% url 'cosinnus:profile-detail' username=member.username %}">
                                                                    {{ member|full_name }}
                                                                </a>
                                                                {% include 'cosinnus/user/member_list_name_snippet.html' with user=member %}
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            
                                            {% if user|has_write_access:object %}    
                                                {% captureas label %}{% blocktrans with name=member|full_name %}Do you really want to accept user „{{ name }}“ as a member?{% endblocktrans %}{% endcaptureas %}
                                                {% captureas title %}{% trans "Accept Member" %}{% endcaptureas %}
                                                {% captureas action %}{% group_url 'cosinnus:group-user-edit' group=object username=member.username %}{% endcaptureas %}
                                                {% captureas extra_fields %}<input type="hidden" name="user" value="{{member.pk}}" /><input type="hidden" name="status" value="1" />{% endcaptureas %}
                                                {% include "cosinnus/modal_box.html" with id=modal_promote_id label=label title=title form_action=action form_extra_fields=extra_fields %}
                                                
                                                {% captureas label %}{% blocktrans with name=member|full_name %}Do you really want to decline member „{{ name }}“?{% endblocktrans %}{% endcaptureas %}
                                                {% captureas title %}{% trans "Decline Member" %}{% endcaptureas %}
                                                {% captureas action %}{% group_url 'cosinnus:group-user-delete' group=object username=member.username %}{% endcaptureas %}
                                                {% include "cosinnus/modal_box.html" with id=modal_kick_id label=label title=title form_action=action %}
                                            {% endif %}
                                        
                                        {% endif %}
                                        
                                    {% empty %}
                                        <!-- {% trans "There are no new membership requests." %} -->
                                        {% include 'cosinnus/common/empty_button.html' with message="There are no new membership requests." %}
                                    {% endfor %}
                                    
                                    <div class="clearfix"></div>
                    
                    
                                </div> {% comment %} panel-body {% endcomment %}
                            </div> {% comment %} panel-collapse {% endcomment %}
                        </div> {% comment %} panel {% endcomment %}
                    
                    {% endif %}
                {% endif %}
            {% endif %} {% comment %} End "if group isn't the forum" condition {% endcomment %}
    
            <div class="panel panel-default large-space">
                <div class="panel-heading">
                    <h4 class="panel-title {% if request.GET.invite %}collapsed{% endif %}" data-toggle="collapse" data-target="#collapseThree">
                        <i class="fa fa-chevron-down panel-collapsed"></i>
                        <i class="fa fa-chevron-up panel-open"></i>
                        {% trans "Current Members" %} ({{ member_count }})
                        {% if user_is_superuser and inactive_member_count %}
                            (+{{ inactive_member_count }} {% trans "inactive" %})
                        {% endif %}
                    </h4>
                </div>
                <div id="collapseThree" class="panel-collapse {% if request.GET.invite %}collapse{% else %}in{% endif %}">
                    <div class="panel-body">
                        
                        {% if not 'cosinnus_message' in SETTINGS.COSINNUS_DISABLED_COSINNUS_APPS %}
                        <div class="large-space">
                            {% if not group.slug == SETTINGS.NEWW_FORUM_GROUP_SLUG and not SETTINGS.COSINNUS_IS_INTEGRATED_PORTAL %}
                                <div href="{% if SETTINGS.COSINNUS_ROCKET_ENABLED %}{% url "cosinnus:message-write-group" slug=group.slug %}{% else %}{% url "postman:write-group" group_recipients=group.slug %}{% endif %}" class="btn btn-small btn-emphasized">
                                    <ul class="media-list">
                                        <li class="media">
                                            <a class="pull-left" href="#">
                                                <i class="fa fa-envelope"></i>
                                            </a>
                                            <div class="media-body">
                                                {% trans "Message all members" %}
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            {% endif %}
                            <legend>
                                {% trans "Members" %}
                                {% if member_count %} ({{ member_count }}){% endif %}
                                {% if user_is_superuser and inactive_member_count %}
                                    (+{{ inactive_member_count }} {% trans "inactive" %})
                                {% endif %}
                            </legend>
                        </div>
                        <div class="clearfix"></div>
                        {% endif %}
                        
                        {% for member in members %}
                            {% with member_active=member|is_user_active %}
                                
                                <div class="fadedown {% if not forloop.last or hidden_user_count > 0 %}regular-space{% endif %}">
                                    <div class="btn btn-{% if member_active %}emphasized{% else %}default{% endif %} w100 user-list-button">
                                        <ul class="media-list">
                                            <li class="media">
                                                <a class="pull-left" href="{{ member|profile_url }}">
                                                    {% include "cosinnus/user/user_avatar_image.html" with user=member %}
                                                </a>
                                                {% if user|has_write_access:object %}
                                                <a class="pull-right fadedown-clickarea" href="#">
                                                    <i class="fa fa-chevron-down"></i>
                                                </a>
                                                {% endif %}
                                                {% if not member == user and not SETTINGS.COSINNUS_IS_INTEGRATED_PORTAL %}
                                                {% if not 'cosinnus_message' in SETTINGS.COSINNUS_DISABLED_COSINNUS_APPS %}
                                                <a class="pull-right" href="{% if SETTINGS.COSINNUS_ROCKET_ENABLED %}{% url 'cosinnus:message-write' username=member.username %}" title="{% trans "Send Message" %}{% else %}{% url 'postman:write' recipients=member.username %}{% endif %}" title="{% trans "Send Message" %}">
                                                    <i class="fa fa-envelope"></i>
                                                </a>
                                                {% endif %}
                                                {% endif %}
                                                <div class="media-body username-body">
                                                    <span class="annotation">
                                                        {% if member in admins %}
                                                            {% trans "Admin" %}
                                                        {% elif member in members %}
                                                            {% trans "Member" %}
                                                        {% endif %}
                                                    </span>
                                                    <a class="username-name" href="{% url 'cosinnus:profile-detail' username=member.username %}">
                                                        {% if member.is_guest %}
                                                            <i>({% trans "Guest" %})</i>
                                                        {% elif not member_active %}
                                                            <i>({% trans "User account inactive" %})</i>
                                                        {% endif %}
                                                        {{ member|full_name }}
                                                    </a>
                                                    {% include 'cosinnus/user/member_list_name_snippet.html' with user=member %}

                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                    
                                    <div>
                                        {% if user|has_write_access:object %}
                                            {% captureas modal_kick_id %}userModal_kick_{{member.pk}}{% endcaptureas %}
                                            {% captureas modal_promote_id %}userModal_promote_{{member.pk}}{% endcaptureas %}
                                            <button type="button" class="btn btn-emphasized" data-toggle="modal" data-target="#{{modal_kick_id}}">
                                                <ul class="media-list">
                                                    <li class="media">
                                                        <span class="pull-left">
                                                            <i class="fa fa-eraser"></i>
                                                        </span>
                                                        <div class="media-body">
                                                            {% trans "Kick" %}
                                                        </div>
                                                    </li>
                                                </ul>
                                            </button>

                                            {% if not member.is_guest %}
                                                <button type="button" class="btn btn-emphasized" data-toggle="modal" data-target="#{{modal_promote_id}}">
                                                    <ul class="media-list">
                                                        <li class="media">
                                                            <span class="pull-left">
                                                                <i class="fa fa-group"></i>
                                                            </span>
                                                            <div class="media-body">
                                                                {% if member in admins %}
                                                                    {% trans "Make Member" %}
                                                                {% else %}
                                                                    {% trans "Make Admin" %}
                                                                {% endif %}
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </button>
                                            {% endif %}
                                        {% endif %}
                                        
                                        {% include 'cosinnus/feedback/report_button_btn.html' with object=member %}
                                    </div>
                                    
                                </div><!-- fadedown -->
                                
                                {% if user|has_write_access:object %}    
                                    {% if member in admins %}
                                        {% captureas label %}{% blocktrans with name=member|full_name %}Do you really want to demote administrator „{{ name }}“ to member?{% endblocktrans %}{% endcaptureas %}
                                        {% captureas title %}{% trans "Demote Admin" %}{% endcaptureas %}
                                        {% captureas action %}{% group_url 'cosinnus:group-user-edit' group=object username=member.username %}{% endcaptureas %}
                                        {% captureas extra_fields %}<input type="hidden" name="user" value="{{member.pk}}" /><input type="hidden" name="status" value="1" />{% endcaptureas %}
                                    {% else %}
                                        {% captureas label %}{% blocktrans with name=member|full_name %}Do you really want to promote member „{{ name }}“ to administrator?{% endblocktrans %}{% endcaptureas %}
                                        {% captureas title %}{% trans "Promote Member" %}{% endcaptureas %}
                                        {% captureas action %}{% group_url 'cosinnus:group-user-edit' group=object username=member.username %}{% endcaptureas %}
                                        {% captureas extra_fields %}<input type="hidden" name="user" value="{{member.pk}}" /><input type="hidden" name="status" value="2" />{% endcaptureas %}
                                    {% endif %}
                                    {% include "cosinnus/modal_box.html" with id=modal_promote_id label=label title=title form_action=action form_extra_fields=extra_fields %}
                                    
                                    {% captureas label %}{% blocktrans with name=member|full_name %}Do you really want to remove member „{{ name }}“ from the team?{% endblocktrans %}{% endcaptureas %}
                                    {% captureas title %}{% trans "Remove Member" %}{% endcaptureas %}
                                    {% captureas action %}{% group_url 'cosinnus:group-user-delete' group=object username=member.username %}{% endcaptureas %}
                                    {% include "cosinnus/modal_box.html" with id=modal_kick_id label=label title=title form_action=action %}
                                    
                                {% endif %}
                            {% endwith %}
                        {% endfor %}
                        
                        {% if hidden_user_count > 0 %}
                            <div class="btn btn-default w100">
                                <ul class="media-list">
                                    <li class="media">
                                        <span class="pull-left">
                                            <img src="{% static 'images/jane-doe.png' %}" />
                                        </span>
                                        <div class="media-body">
                                            {% blocktrans with hidden_count=hidden_user_count %}And {{ hidden_count }} private users...{% endblocktrans %}
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        {% endif %}
                        
                        {% if more_user_count > 0 %}
                            <br/>
                            <div class="btn btn-default w100" href="?show=all">
                                <ul class="media-list">
                                    <li class="media">
                                        <a class="pull-left">
                                            <i class="fa fa-chevron-down"></i>
                                        </a>
                                        <div class="media-body">
                                            <a href="?show=all">
                                                {% blocktrans with more_count=more_user_count %}Show all of the other {{ more_count }} users...{% endblocktrans %}
                                            </a>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        {% endif %}
                        
                    </div> {% comment %} panel-body {% endcomment %}
                </div> {% comment %} panel-collapse {% endcomment %}
            </div> {% comment %} panel {% endcomment %}
    
        </div>

    {% endif %}
  
  
{% endblock %}
